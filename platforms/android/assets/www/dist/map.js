var openvegemap=function(){"use strict";function e(e,t){var o="diet:"+e;return!(!t[o]||"yes"!==t[o]&&"only"!==t[o])}function t(e,t){var o="diet:"+e;return!(!t[o]||"no"!==t[o])}function o(e,t){var o="diet:"+e;return!(!t[o]||"only"!==t[o])}function a(e,t){return t?'<ons-list-item modifier="nodivider"><div class="left">'+e+'</div> <div class="right">'+t.replace(/_/g," ")+"</div></ons-list-item>":""}function n(e){var t="",o=L.DomUtil.create("a");t+=a("Vegan",e.target.feature.tags["diet:vegan"]),t+=a("Vegetarian",e.target.feature.tags["diet:vegetarian"]),e.target.feature.tags.cuisine&&(t+=a("Cuisine",e.target.feature.tags.cuisine.replace(/;/g,", "))),t+=a("Take away",e.target.feature.tags.takeaway),e.target.feature.tags.phone&&(t+=a("Phone number",'<a href="tel:'+e.target.feature.tags.phone+'">'+e.target.feature.tags.phone.replace(/\s/g,"&nbsp;")+"</a>")),e.target.feature.tags.website&&(o.href=e.target.feature.tags.website,"localhost"===o.hostname&&(e.target.feature.tags.website="http://"+e.target.feature.tags.website),t+=a("Website",'<a target="_blank" href="'+e.target.feature.tags.website+'">'+e.target.feature.tags.website+"</a>")),e.target.feature.tags.name||(e.target.feature.tags.name=""),L.DomUtil.get("mapPopupTitle").innerHTML=e.target.feature.tags.name,L.DomUtil.get("mapPopupList").innerHTML=t,L.DomUtil.get("gmapsLink").setAttribute("href","https://www.google.fr/maps/dir//"+e.target.feature.lat+","+e.target.feature.lon),L.DomUtil.get("editLink").setAttribute("href","https://editor.openvegemap.netlib.re/"+e.target.feature.type+"/"+e.target.feature.id),L.DomUtil.get("mapPopup").show()}function r(e){switch(e.shop){case"bakery":return"ü•ñ"}if(e.shop)return"üõí";switch(e.craft){case"caterer":return"üç¥"}switch(e.amenity){case"fast_food":return"üçî";case"restaurant":return"üç¥";case"cafe":return"üçµ";case"bar":return"üç∏";case"pub":return"üç∫";default:return""}}function i(t){return o("vegan",t)?z["vegan-only"]:o("vegetarian",t)?z["vegetarian-only"]:e("vegan",t)?z.vegan:e("vegetarian",t)?z.vegetarian:z.other}function l(a){return o("vegan",a)?"dot-circle-o":e("vegan",a)?"circle":e("vegetarian",a)?"circle-o":t("vegetarian",a)?"ban":"question"}function s(o){return e("vegan",o)?"green":e("vegetarian",o)?"darkgreen":t("vegetarian",o)?"red":"gray"}function g(e){if(-1===P.indexOf(e.id)){P.push(e.id),e.center&&(e.lat=e.center.lat,e.lon=e.center.lon);var t=L.marker([e.lat,e.lon]);t.feature=e,t.setIcon(L.AwesomeMarkers.icon({icon:l(e.tags),prefix:"fa",markerColor:s(e.tags)})),t.on("click",n),e.tags.name&&t.bindTooltip(r(e.tags)+"&nbsp;"+e.tags.name,{direction:"bottom"}),t.addTo(i(e.tags))}}function c(){x.hide()}function u(){x.show()}function m(){M.open()}function d(){B._layer=new L.LayerGroup,B._layer.addTo(I),B._map=I,B._container=L.DomUtil.create("div"),B._icon=L.DomUtil.create("div"),B.start(),M.close()}function f(){C._geocode()}function p(e){var t=L.circle(e.geocode.center,10);t.addTo(I),I.fitBounds(t.getBounds()),S.geocodeDialog.hide(),M.close()}function h(e){e.elements.forEach(g)}function v(){S[this.dialog].show(),V[this.dialog]&&"function"==typeof V[this.dialog].show&&V[this.dialog].show()}function b(e){S[e.id]=e,V[e.id]&&"function"==typeof V[e.id].init&&V[e.id].init()}function D(e){var t;for(t=0;t<q.length;t+=1)z[q[t]].removeFrom(I);for(t=0;t<q.length&&(e.endsWith("-only")&&!q[t].endsWith("-only")||z[q[t]].addTo(I),q[t]!==e);t+=1);window.localStorage.setItem("filter",e)}function w(){var e,t=document.getElementsByName("filter");for(e=0;e<t.length;e+=1)if(t[e].checked){D(t[e].getAttribute("input-id"));break}S.filtersDialog.hide(),M.close()}function y(){var e=window.localStorage.getItem("filter");return e||(e="vegetarian"),e}function k(){var e;for(e=0;e<q.length;e+=1)z[q[e]]=L.layerGroup()}function U(e){var t=e.target.getZoom();t>=15&&Z?(S.zoomToast.hide(),Z=!1):t<15&&!Z&&(S.zoomToast.show(),Z=!0)}function T(){(C=new L.Control.Geocoder({geocoder:new L.Control.Geocoder.Nominatim({serviceUrl:"https://nominatim.openstreetmap.org/"}),position:"topleft",defaultMarkGeocode:!1}).on("markgeocode",p))._alts=L.DomUtil.get("geocodeAlt"),C._container=S.geocodeDialog,C._errorElement=L.DomUtil.get("geocodeError"),C._input=L.DomUtil.get("geocodeInput"),L.DomEvent.on(L.DomUtil.get("geocodeDialogBtn"),"click",f)}function _(){L.DomEvent.on(L.DomUtil.get("filtersDialogBtn"),"click",w)}function A(){L.DomUtil.get(y()).checked=!0}function E(){U({target:I})}var I,x,M,B,C,P=[],z={},q=["vegan-only","vegan","vegetarian-only","vegetarian","other"],S={},V={},Z=!1;return{init:function(){M=L.DomUtil.get("menu"),I=L.map("map",{center:[48.85661,2.351499],zoom:16,maxZoom:19,minZoom:3,maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1}),x=L.control.loader().addTo(I);var e=L.UrlUtil.hash();L.DomEvent.on(L.DomUtil.get("menuBtn"),"click",m),L.DomEvent.on(L.DomUtil.get("geocodeMenuItem"),"click",v,{dialog:"geocodeDialog"}),L.DomEvent.on(L.DomUtil.get("filtersMenuItem"),"click",v,{dialog:"filtersDialog"}),L.DomEvent.on(L.DomUtil.get("locateMenuItem"),"click",d),L.DomEvent.on(L.DomUtil.get("aboutMenuItem"),"click",v,{dialog:"aboutDialog"}),L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",{detectRetina:!0,maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors & <a target="_blank" href="https://maps.wikimedia.org/">Wikimedia maps</a>'}).addTo(I),B=L.control.locate({position:"topright"}),L.UrlUtil.queryParse(e).lat&&window.localStorage.setItem("paramsTemp",e),I.addControl(new L.Control.Permalink({useLocation:!0,useLocalStorage:!0})),I.addControl(new InfoControl({position:"bottomright",content:'<i class="fa fa-circle" style="background-color: #72AF26"></i> Vegan<br/><i class="fa fa-dot-circle-o" style="background-color: #72AF26"></i> Vegan only<br/><i class="fa fa-circle-o" style="background-color: #728224"></i> Vegetarian<br/><i class="fa fa-ban" style="background-color: #D63E2A"></i> Meat only<br/><i class="fa fa-question" style="background-color: #575757"></i> Unknown<br/>'})),new L.OverPassLayer({endPoint:"https://overpass-api.de/api/",query:'node({{bbox}})[~"^diet:.*$"~"."];out;way({{bbox}})[~"^diet:.*$"~"."];out center;',beforeRequest:u,afterRequest:c,onSuccess:h,minZoomIndicatorEnabled:!1}).addTo(I),k(),D(y()),V={geocodeDialog:{init:T},filtersDialog:{init:_,show:A},zoomToast:{init:E}},ons.createAlertDialog("templates/about.html").then(b),ons.createAlertDialog("templates/geocode.html").then(b),ons.createAlertDialog("templates/filters.html").then(b),ons.createAlertDialog("templates/popup.html").then(b),ons.createAlertDialog("templates/zoom.html").then(b),I.on("zoom",U)}}}();if("object"!=typeof ons)throw"Onsen is not loaded";ons.ready(openvegemap.init);
//# sourceMappingURL=map.js.map
var oldbrowser=function(){"use strict";function e(){"function"!=typeof MutationObserver&&(document.getElementsByTagName("body")[0].innerHTML='Your browser does not support <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver</a>. Please update your browser.')}return{init:function(){e()}}}();if("object"!=typeof L)throw"Leaflet is not loaded";L.DomEvent.on(window,"load",oldbrowser.init);var openvegemap=function(){"use strict";function e(e,t){var o="diet:"+e;return!(!t[o]||"yes"!==t[o]&&"only"!==t[o])}function t(e,t){var o="diet:"+e;return!(!t[o]||"no"!==t[o])}function o(e,t){var o="diet:"+e;return!(!t[o]||"only"!==t[o])}function n(e,t){return t?'<ons-list-item modifier="nodivider"><div class="left">'+e+'</div> <div class="right">'+t.replace(/_/g," ")+"</div></ons-list-item>":""}function r(e){return'<ons-list-item id="hoursBtn" tappable modifier="chevron"><div class="left">Opening hours<br/>('+new window.opening_hours(e,null).getStateString(new Date,!0)+")</div></ons-list-item>"}function a(e){return e.getHours().toString().padStart(2,0)+":"+e.getMinutes().toString().padStart(2,0)}function i(e){return e.toLocaleDateString("en-US",{weekday:"long"})}function l(e,t){var o="";if(e-t>oe)for(var n=t;n.getDay()<e.getDay();)(1===n.getDay()||n.getDay()>t.getDay())&&(o+="<tr><th>"+i(n)+'</th><td colspan="2">Closed</td></tr>'),n=new Date(n.getTime()+oe);return o}function c(e,t,o,n,r){var l="";return e.getState(o)&&o!==t&&(l+="<tr><th>",r!==n&&(l+=i(o)),l+="</th><td>"+a(o)+"<td>"+a(t)+"</td></tr>"),l}function s(e){var t,o,n=new window.opening_hours(e,null),r=n.getIterator(),a="",i=new Date(2017,0,2),s=i,g=new Date(2017,0,1);for(r.setDate(i),o=new Date(i.getTime()+ne);r.advance(o);)i=r.getDate(),t=s.getDay(),0===s.getHours()&&0===s.getMinutes()||(a+=c(n,i,s,t,g),a+=l(i,s),n.getState(s)&&g!==t&&(g=t)),s=i;return 0===i.getDay()?(r.advance(),a+=c(n,r.getDate(),i,s.getDay(),g)):a+='<tr><th>Sunday</th><td colspan="2">Closed<td></tr>',a||(a+="<tr><th>Sorry, we don't have enough info</th></tr>"),a}function g(){X[this.dialog].show(this.target),ee[this.dialog]&&"function"==typeof ee[this.dialog].show&&ee[this.dialog].show()}function u(e){var t="",o=L.DomUtil.create("a");return t+=n("Vegan",e["diet:vegan"]),t+=n("Vegetarian",e["diet:vegetarian"]),e.cuisine&&(t+=n("Cuisine",e.cuisine.replace(/;/g,", "))),t+=n("Take away",e.takeaway),e.phone&&(t+=n("Phone number",'<a href="tel:'+e.phone+'">'+e.phone.replace(/\s/g,"&nbsp;")+"</a>")),e.website&&(o.href=e.website,"localhost"===o.hostname&&(e.website="http://"+e.website),t+=n("Website",'<a target="_blank" href="'+e.website+'">'+e.website+"</a>")),e.opening_hours&&(t+=r(e.opening_hours)),t}function d(e,t){var o=window.localStorage.getItem("routing-provider");return o||(o=re.google),e&&(o=o.replace("{LAT}",e)),t&&(o=o.replace("{LON}",t)),o}function m(e){var t="";if(t+=u(e.target.feature.tags),e.target.feature.tags.opening_hours&&(L.DomUtil.get("hoursTable").innerHTML=s(e.target.feature.tags.opening_hours)),e.target.feature.tags.name||(e.target.feature.tags.name=""),L.DomUtil.get("mapPopupTitle").innerHTML=e.target.feature.tags.name,L.DomUtil.get("mapPopupList").innerHTML=t,L.DomUtil.get("gmapsLink").setAttribute("href",d(e.target.feature.lat,e.target.feature.lon)),L.DomUtil.get("editLink").setAttribute("href","https://editor.openvegemap.netlib.re/"+e.target.feature.type+"/"+e.target.feature.id),e.target.feature.tags.opening_hours){var o=L.DomUtil.get("hoursBtn");L.DomEvent.on(o,"click",g,{dialog:"hoursPopup",target:o})}L.DomUtil.get("mapPopup").show()}function f(e){switch(e.shop){case"bakery":return"🥖";default:return"🛒"}}function p(e){switch(e.craft){case"caterer":return"🍴";default:return""}}function h(e){switch(e.amenity){case"fast_food":return"🍔";case"restaurant":return"🍴";case"cafe":return"🍵";case"bar":return"🍸";case"pub":return"🍺";default:return""}}function v(e){return e.shop?f(e):e.craft?p(e):e.amenity?h(e):""}function D(t){return o("vegan",t)?K["vegan-only"]:e("vegan",t)?K.vegan:o("vegetarian",t)?K["vegetarian-only"]:e("vegetarian",t)?K.vegetarian:K.other}function w(n){return o("vegan",n)?"dot-circle-o":e("vegan",n)?"circle":e("vegetarian",n)?"circle-o":t("vegetarian",n)?"ban":"question"}function b(o){return e("vegan",o)?"green":e("vegetarian",o)?"darkgreen":t("vegetarian",o)?"red":"gray"}function y(e){if(-1===Y.indexOf(e.id)){Y.push(e.id),e.center&&(e.lat=e.center.lat,e.lon=e.center.lon);var t=L.marker([e.lat,e.lon]);t.feature=e,t.setIcon(L.AwesomeMarkers.icon({icon:w(e.tags),prefix:"fa",markerColor:b(e.tags)})),t.on("click",m),e.tags.name&&t.bindTooltip(v(e.tags)+"&nbsp;"+e.tags.name,{direction:"bottom"}),t.addTo(D(e.tags))}}function k(){J.hide()}function U(){J.show()}function T(){R.open()}function S(){W.locate({setView:!0,enableHighAccuracy:!0}),R.close()}function E(){$._geocode()}function A(e){var t=L.circle(e.geocode.center,10);t.addTo(W),W.fitBounds(t.getBounds()),X.geocodeDialog.hide(),R.close()}function M(e){e.elements.forEach(y)}function I(e){X[e.id]=e,ee[e.id]&&"function"==typeof ee[e.id].init&&ee[e.id].init()}function _(e){K[e].removeFrom(W)}function O(e){K[e].addTo(W)}function B(){var e=[];Q.forEach(_),Q.forEach(function(t){var o=L.DomUtil.get(t+"-filter");o&&o.checked&&e.push(t)}),e.forEach(O),window.localStorage.setItem("filters",JSON.stringify(e)),X.filtersDialog.hide(),R.close()}function P(){var e=JSON.parse(window.localStorage.getItem("filters"));return e||(e=["vegan","vegan-only","vegetarian","vegetarian-only"]),e}function x(e){K[e]=L.layerGroup()}function C(){Q.forEach(x)}function N(e){var t=e.target.getZoom();t>=15&&te?(X.zoomToast.hide(),te=!1):t<15&&!te&&(X.zoomToast.show(),te=!0)}function z(){($=new L.Control.Geocoder({geocoder:new L.Control.Geocoder.Nominatim({serviceUrl:"https://nominatim.openstreetmap.org/"}),position:"topleft",defaultMarkGeocode:!1}).on("markgeocode",A))._alts=L.DomUtil.get("geocodeAlt"),$._container=X.geocodeDialog,$._errorElement=L.DomUtil.get("geocodeError"),$._input=L.DomUtil.get("geocodeInput"),L.DomEvent.on(L.DomUtil.get("geocodeDialogBtn"),"click",E)}function H(){L.DomEvent.on(L.DomUtil.get("filtersDialogBtn"),"click",B)}function V(e){L.DomUtil.get(e+"-filter").checked=!0}function q(){P().forEach(V)}function Z(){var e=re.google;L.DomUtil.get("custom-routingprovider").checked&&(e=L.DomUtil.get("custom-routingprovider-url").value),Object.keys(re).some(function(t){return!!L.DomUtil.get(t+"-routingprovider").checked&&(e=re[t],!0)}),window.localStorage.setItem("routing-provider",e),X.preferencesDialog.hide(),R.close()}function j(){L.DomEvent.on(L.DomUtil.get("preferencesDialogBtn"),"click",Z)}function G(){var e,t=window.localStorage.getItem("routing-provider");Object.keys(re).some(function(o){return t===re[o]&&(e=o,!0)}),!e&&t&&(L.DomUtil.get("custom-routingprovider-url").value=t,e="custom"),e||(e="google"),L.DomUtil.get(e+"-routingprovider").checked=!0}function F(){N({target:W})}var W,J,R,$,Y=[],K={},Q=["vegan-only","vegan","vegetarian-only","vegetarian","other"],X={},ee={},te=!1,oe=864e5,ne=7*oe,re={google:"https://www.google.com/maps/dir//{LAT},{LON}",graphhopper:"https://graphhopper.com/maps/?point=&point={LAT},{LON}",openroute:"https://openrouteservice.org/directions?a=null,null,{LAT},{LON}"};return{init:function(){R=L.DomUtil.get("menu"),W=L.map("map",{center:[48.85661,2.351499],zoom:16,maxZoom:19,minZoom:3,maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1}),J=L.control.loader().addTo(W);var e=L.UrlUtil.hash();L.DomEvent.on(L.DomUtil.get("menuBtn"),"click",T),L.DomEvent.on(L.DomUtil.get("geocodeMenuItem"),"click",g,{dialog:"geocodeDialog"}),L.DomEvent.on(L.DomUtil.get("filtersMenuItem"),"click",g,{dialog:"filtersDialog"}),L.DomEvent.on(L.DomUtil.get("preferencesMenuItem"),"click",g,{dialog:"preferencesDialog"}),L.DomEvent.on(L.DomUtil.get("locateMenuItem"),"click",S),L.DomEvent.on(L.DomUtil.get("aboutMenuItem"),"click",g,{dialog:"aboutDialog"}),L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png",{maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors & <a target="_blank" href="https://maps.wikimedia.org/">Wikimedia maps</a>'}).addTo(W),L.UrlUtil.queryParse(e).lat&&window.localStorage.setItem("paramsTemp",e),W.addControl(new L.Control.Permalink({useLocation:!0,useLocalStorage:!0})),W.addControl(new InfoControl({position:"bottomright",content:'<i class="fa fa-circle" style="background-color: #72AF26"></i> Vegan<br/><i class="fa fa-dot-circle-o" style="background-color: #72AF26"></i> Vegan only<br/><i class="fa fa-circle-o" style="background-color: #728224"></i> Vegetarian<br/><i class="fa fa-ban" style="background-color: #D63E2A"></i> Meat only<br/><i class="fa fa-question" style="background-color: #575757"></i> Unknown<br/>'})),new L.OverPassLayer({endPoint:"https://overpass-api.de/api/",query:'node({{bbox}})[~"^diet:.*$"~"."];out;way({{bbox}})[~"^diet:.*$"~"."];out center;',beforeRequest:U,afterRequest:k,onSuccess:M,minZoomIndicatorEnabled:!1}).addTo(W),C(),P().forEach(O),ee={geocodeDialog:{init:z},filtersDialog:{init:H,show:q},preferencesDialog:{init:j,show:G},zoomToast:{init:F}},ons.createAlertDialog("templates/about.html").then(I),ons.createAlertDialog("templates/geocode.html").then(I),ons.createAlertDialog("templates/filters.html").then(I),ons.createAlertDialog("templates/preferences.html").then(I),ons.createAlertDialog("templates/popup.html").then(I),ons.createAlertDialog("templates/zoom.html").then(I),ons.createAlertDialog("templates/hours.html").then(I),W.on("zoom",N)}}}();if("object"!=typeof ons)throw"Onsen is not loaded";ons.ready(openvegemap.init);
//# sourceMappingURL=map.js.map